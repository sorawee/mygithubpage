<!doctype HTML>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="codemirror.js"></script>
<script src="runmode.js"></script>
<script src="pyret.js"></script>
<script src="hilite.js"></script>
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>5.2&nbsp;FFI Helpers</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="styles.css" title="default"/><link rel="stylesheet" type="text/css" href="codemirror.css" title="default"/><link rel="stylesheet" type="text/css" href="editor.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Pyret</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Getting_Started.html" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Language_Concepts.html" class="tocviewlink" data-pltdoc="x">Language Concepts</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Builtins.html" class="tocviewlink" data-pltdoc="x">Builtins</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Libraries.html" class="tocviewlink" data-pltdoc="x">Libraries</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Internals.html" class="tocviewselflink" data-pltdoc="x">Internals</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td>5&nbsp;</td><td><a href="Internals.html" class="tocviewlink" data-pltdoc="x">Internals</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="runtime.html" class="tocviewlink" data-pltdoc="x">Runtime API</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">FFI Helpers</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="s_running.html" class="tocviewlink" data-pltdoc="x">Running Code (Safely)</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="Modules.html" class="tocviewlink" data-pltdoc="x">Modules</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>5.2&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">FFI Helpers</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.2.1&nbsp;</td><td><a href="#%28part._.Equality%29" class="tocviewlink" data-pltdoc="x">Equality</a></td></tr><tr><td align="right">5.2.2&nbsp;</td><td><a href="#%28part._ffi~3aexceptions%29" class="tocviewlink" data-pltdoc="x">Exceptions</a></td></tr><tr><td align="right">5.2.3&nbsp;</td><td><a href="#%28part._ffi~3alists%29" class="tocviewlink" data-pltdoc="x">Lists</a></td></tr><tr><td align="right">5.2.4&nbsp;</td><td><a href="#%28part._.Other_.Data_.Helpers%29" class="tocviewlink" data-pltdoc="x">Other Data Helpers</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">5.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Equality%29" class="tocsubseclink" data-pltdoc="x">Equality</a></td></tr><tr><td><a href="#%28part._.F.F.I_equal%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.equal</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_unknown%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.unknown</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_not.Equal%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.not<span class="mywbr"> &nbsp;</span>Equal</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_is.Equal%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.is<span class="mywbr"> &nbsp;</span>Equal</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_is.Not.Equal%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.is<span class="mywbr"> &nbsp;</span>Not<span class="mywbr"> &nbsp;</span>Equal</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_is.Unknown%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.is<span class="mywbr"> &nbsp;</span>Unknown</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_is.Equality.Result%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.is<span class="mywbr"> &nbsp;</span>Equality<span class="mywbr"> &nbsp;</span>Result</span></a></td></tr><tr><td><span class="tocsublinknumber">5.2.2<tt>&nbsp;</tt></span><a href="#%28part._ffi~3aexceptions%29" class="tocsubseclink" data-pltdoc="x">Exceptions</a></td></tr><tr><td><a href="#%28part._.F.F.I_throw.Message.Exception%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.throw<span class="mywbr"> &nbsp;</span>Message<span class="mywbr"> &nbsp;</span>Exception</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_make.Message.Exception%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.make<span class="mywbr"> &nbsp;</span>Message<span class="mywbr"> &nbsp;</span>Exception</span></a></td></tr><tr><td><span class="tocsublinknumber">5.2.3<tt>&nbsp;</tt></span><a href="#%28part._ffi~3alists%29" class="tocsubseclink" data-pltdoc="x">Lists</a></td></tr><tr><td><a href="#%28part._.F.F.I_make.List%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.make<span class="mywbr"> &nbsp;</span>List</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_to.Array%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.to<span class="mywbr"> &nbsp;</span>Array</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_is.List%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.is<span class="mywbr"> &nbsp;</span>List</span></a></td></tr><tr><td><span class="tocsublinknumber">5.2.4<tt>&nbsp;</tt></span><a href="#%28part._.Other_.Data_.Helpers%29" class="tocsubseclink" data-pltdoc="x">Other Data Helpers</a></td></tr><tr><td><a href="#%28part._.F.F.I_make.Some%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.make<span class="mywbr"> &nbsp;</span>Some</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_make.None%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.make<span class="mywbr"> &nbsp;</span>None</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_make.Left%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.make<span class="mywbr"> &nbsp;</span>Left</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_make.Right%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.make<span class="mywbr"> &nbsp;</span>Right</span></a></td></tr><tr><td><a href="#%28part._.F.F.I_cases%29" class="tocsubnonseclink" data-pltdoc="x"><span class="stt">FFI.cases</span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="runtime.html" title="backward to &quot;5.1 Runtime API&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Internals.html" title="up to &quot;5 Internals&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="s_running.html" title="forward to &quot;5.3 Running Code (Safely)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h4>5.2<tt>&nbsp;</tt><a name="(part._ffi)"></a>FFI Helpers</h4><p>There are a number of convenience functions that aren&rsquo;t native to the Pyret
runtime, but are often used in JavaScript code that interacts with the runtime.
Some of the most commonly used ones are documented here; this list is often
growing.</p><h5>5.2.1<tt>&nbsp;</tt><a name="(part._.Equality)"></a>Equality</h5><p>The ffi exposes several utilities related to <a href="equality.html" data-pltdoc="x">equality</a>.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_equal)" class="pyret-code"></a><span class="stt">FFI.equal</span> :: <span class="stt">PyretObject</span></p></div></div><p>The <a href="equality.html#%28part._equality_.Equal%29" data-pltdoc="x"><span class="stt">Equal</span></a> value.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_unknown)" class="pyret-code"></a><span class="stt">FFI.unknown</span> :: <span class="stt">PyretObject</span></p></div></div><p>The <a href="equality.html#%28part._equality_.Unknown%29" data-pltdoc="x"><span class="stt">Unknown</span></a> value.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_not.Equal)" class="pyret-code"></a><span class="stt">FFI.notEqual</span> :: <span class="stt">PyretFunction</span></p></div></div><p>The <a href="equality.html#%28part._equality_.Not.Equal%29" data-pltdoc="x"><span class="stt">NotEqual</span></a> constructor.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_is.Equal)" class="pyret-code"></a><span class="stt">FFI.isEqual</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">JSBoolean</span></p></div></div><p>Checks if the given value is <a href="equality.html#%28part._equality_.Equal%29" data-pltdoc="x"><span class="stt">Equal</span></a>.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_is.Not.Equal)" class="pyret-code"></a><span class="stt">FFI.isNotEqual</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">JSBoolean</span></p></div></div><p>Checks if the given value is an instance of <a href="equality.html#%28part._equality_.Not.Equal%29" data-pltdoc="x"><span class="stt">NotEqual</span></a>.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_is.Unknown)" class="pyret-code"></a><span class="stt">FFI.isUnknown</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">JSBoolean</span></p></div></div><p>Checks if the given value is a <a href="equality.html#%28part._equality_.Unknown%29" data-pltdoc="x"><span class="stt">Unknown</span></a>.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_is.Equality.Result)" class="pyret-code"></a><span class="stt">FFI.isEqualityResult</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">JSBoolean</span></p></div></div><p>Checks if the given value is an instance of a <a href="equality.html#%28part._equality_.Equality.Result%29" data-pltdoc="x"><span class="stt">EqualityResult</span></a>.</p><h5>5.2.2<tt>&nbsp;</tt><a name="(part._ffi~3aexceptions)"></a>Exceptions</h5><p>FFI helpers provide the easiest way to programmatically throw Pyret exceptions
from JavaScript.  Most commonly, user-defined modules will simply throw
<span class="stt">MessageExceptions</span> that contain a string describing the error.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_throw.Message.Exception)" class="pyret-code"></a><span class="stt">FFI.throwMessageException</span><span class="stt">(</span><span class="stt">PyretString</span><span class="stt">) &#8594; </span><span class="stt">Undefined</span></p></div></div><p>Throws an exception that Pyret recognizes and reports with a stack trace, using
the provided string as the message.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_make.Message.Exception)" class="pyret-code"></a><span class="stt">FFI.makeMessageException</span><span class="stt">(</span><span class="stt">PyretString</span><span class="stt">) &#8594; </span><span class="stt">Error</span></p></div></div><p>Sometimes its useful to <span style="font-style: italic">create</span> an exception without actually throwing
it, like when using the <span class="stt">error</span> callback of the <span class="stt">Restarter</span> in
<a href="s_running.html#%28part._.Runtime_pause.Stack%29" data-pltdoc="x"><span class="stt">Runtime.pauseStack</span></a>.  This call creates a new exception object
without throwing it.</p><h5>5.2.3<tt>&nbsp;</tt><a name="(part._ffi~3alists)"></a>Lists</h5><p>Pyret lists are ubiquitous in Pyret&rsquo;s internals and libraries, and this library
provides a few conveniences for working with them.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_make.List)" class="pyret-code"></a><span class="stt">FFI.makeList</span><span class="stt">(</span><span class="stt">JSArray</span><span class="stt">) &#8594; </span><span class="stt">List</span></p></div></div><p>Turns a JavaScript array into a Pyret <a href="lists.html#%28part._lists_.List%29" data-pltdoc="x"><span class="stt">List</span></a> with the same
elements in the same order.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_to.Array)" class="pyret-code"></a><span class="stt">FFI.toArray</span><span class="stt">(</span><span class="stt">List</span><span class="stt">) &#8594; </span><span class="stt">JSArray</span></p></div></div><p>Turns a Pyret <a href="lists.html#%28part._lists_.List%29" data-pltdoc="x"><span class="stt">List</span></a> with the same elements in the same
order.  For doing computationally heavy work, sometimes it is useful to convert
a Pyret <span class="stt">List</span> to an array before processing it (and using JavaScript&rsquo;s
map/filter, etc.), since the Pyret version incurs more overhead.</p><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_is.List)" class="pyret-code"></a><span class="stt">FFI.isList</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">JSBoolean</span></p></div></div><p>Returns <span class="stt">true</span> if the value is a Pyret <a href="lists.html#%28part._lists_.List%29" data-pltdoc="x"><span class="stt">List</span></a> and
<span class="stt">false</span> otherwise.</p><h5>5.2.4<tt>&nbsp;</tt><a name="(part._.Other_.Data_.Helpers)"></a>Other Data Helpers</h5><p><div class="SIntrapara"><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_make.Some)" class="pyret-code"></a><span class="stt">FFI.makeSome</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">Option</span></p></div></div></div><div class="SIntrapara"><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_make.None)" class="pyret-code"></a><span class="stt">FFI.makeNone</span><span class="stt">(</span><span class="stt">) &#8594; </span><span class="stt">Option</span></p></div></div></div></p><p>Create instances of <a href="option.html#%28part._option_none%29" data-pltdoc="x"><span class="stt">none</span></a> and <a href="option.html#%28part._option_some%29" data-pltdoc="x"><span class="stt">some</span></a>
from <a href="option.html" data-pltdoc="x">option</a>.</p><p><div class="SIntrapara"><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_make.Left)" class="pyret-code"></a><span class="stt">FFI.makeLeft</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">Either</span></p></div></div></div><div class="SIntrapara"><div class="function"><div class="boxed"><p><a name="(part._.F.F.I_make.Right)" class="pyret-code"></a><span class="stt">FFI.makeRight</span><span class="stt">(</span><span class="stt">Any</span><span class="stt">) &#8594; </span><span class="stt">Either</span></p></div></div></div></p><p>Create instances of <a href="either.html#%28part._either_left%29" data-pltdoc="x"><span class="stt">left</span></a> and <a href="either.html#%28part._either_right%29" data-pltdoc="x"><span class="stt">right</span></a>
from <a href="either.html" data-pltdoc="x">either</a>.</p><div class="function"><div class="boxed"><dl class="multiline-args"><dt class=""><a name="(part._.F.F.I_cases)" class="pyret-code"></a><span class="stt">FFI.cases</span>(</dt><dt class="indent-arg"><span class="stt">(Any -&gt; JSBoolean)</span></dt><dt class="indent-arg"><span class="stt">JSString</span></dt><dt class="indent-arg"><span class="stt">Any</span></dt><dt class="indent-arg"><span class="stt">Handlers</span></dt><dt class=""><span class="stt">)</span></dt><dt class=""><span class="stt">&#8594; Any</span></dt></dl></div></div><p>This call emulates the functionality of the <span class="stt">cases</span> expression in a
JavaScript context.  It takes a predicate to check (usually a function like
<span class="stt">is-List</span>), a name for the predicate being checked, a <span class="stt">data</span> value, and
an object containing handlers for its variants.  For example:</p><p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">function sum(l) {</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">cases(runtime.getField(lists, "is-List"), "List", l, {</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">empty: function() { return "Empty"; },</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">link: function(f, r) { return f + sum(r); }</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">});</span></p></td></tr><tr><td><p><span class="stt">}</span></p></td></tr><tr><td><p><span class="stt">sum(runtime.ffi.makeList([1,2])) // is 3</span></p></td></tr></table></p><p>The predicate check and name are solely for error reporting.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="runtime.html" title="backward to &quot;5.1 Runtime API&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="Internals.html" title="up to &quot;5 Internals&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="s_running.html" title="forward to &quot;5.3 Running Code (Safely)&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>