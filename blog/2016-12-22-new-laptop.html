<html>
<head>
  <meta charset="UTF-8">
  <title>
    My New Laptop & Settings — Sorawee's Website
  </title>
  <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="all" href="../css/styles.css" />
  <link rel="stylesheet" type="text/css" media="all" href="../css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="all" href="../css/styles-github.css" />
  <script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$']]},
      TeX: {
        Macros: {
          seq: ["{\\langle #1 \\rangle}", 1],
          set: ["{\\{ #1 \\}}", 1],
          setof: ["{\\{ #1 \\ | \\ #2 \\}}", 2],
          N: "{\\mathbb N}",
          R: "{\\mathbb R}",
          Z: "{\\mathbb Z}",
          Q: "{\\mathbb Q}",
          floor: ["{\\lfloor #1 \\rfloor}", 1],
          ceil: ["{\\lceil #1 \\rceil}", 1],
        }
      }
    });
  </script>
  <style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
</head>
<body>
  <nav><ul>
    <li><a href="../blog/2016-12-22-new-website.html">&larr; Previous</a></li>
    <li><a href="../">&uarr; Home</a></li>
    <li><a href="../blog/2014-05-11-yahoo-pipes.html">Next &rarr;</a></li>
    <li>
      <a href="2016-12-22-new-laptop.pdf">
        <img src="../css/pdficon.png" width="15" height="15" alt="Download PDF" />
        <span class="caps" style="font-style: normal">PDF</span>
      </a>
    </li>
    <li style="width: auto;">
      <a href="https://github.com/sorawee/my-website/blob/master/blog/2016-12-22-new-laptop.poly.pm" title="View the Pollen source for this file"
         class="sourcelink code">&loz; Pollen Source
      </a>
    </li>
  </ul></nav>
  <section class="page-header">
    <h1 class="project-name">
      <a href="../">Sorawee's Website</a>
    </h1>
    <h2 class="project-tagline"></h2>
    <a href="../" class="btn">Blog</a>
    <a href="../books.html" class="btn">Books</a>
    <a href="../feed.xml" class="btn">RSS</a>
    <a href="../about.html" class="btn">About Me</a>
  </section>
  <section class="main-content" id="the-main">
    <div id="real-content">
      <h1>My New Laptop &amp; Settings</h1><p class="tags">Tags: <a href="/tags/ubuntu">ubuntu</a>, <a href="/tags/thinkpad">thinkpad</a>, <a href="/tags/post">post</a></p><p class="pubdate">Published on Thursday, December 22nd, 2016</p><div class="content"><p>I switched from Ubuntu to Macbook Pro since 2013 and was very happy with it. About 5 months ago, the screen was broken, so I planned to buy a new one. Knowing that the new version will have a major change, I was very excited and decided to wait until it’s released in order to buy it. To my disappointment, <a href="http://www.theverge.com/2016/11/7/13548052/the-macbook-pro-lie">it incredibly sucks</a><label for="7f725ec6-06b9-4e86-875b-fee9814140cb" class="margin-toggle sidenote-number"></label><input type="checkbox" id="7f725ec6-06b9-4e86-875b-fee9814140cb" class="margin-toggle"/><span class="sidenote">I would have loved it if I were not a programmer–the missing <kbd>Esc</kbd> and traditional USB ports matter a lot to me</span>.</p><p>A lot of my friends suggested me to get a Thinkpad X1 Yoga which looks really cool. I waited until Thanksgiving to get a big discount. The laptop arrived in early December. The first thing I did is to install Ubuntu 16.10 because I hate Windows! <i class="em em-stuck_out_tongue"></i></p><p>Following are my settings. I write these particularly for myself in the future so that when I need to set things up again, I won’t have to spend a lot of time figuring out what to do!</p><p><see-more></see-more></p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="c1"># get terminator to make split vertically/horizontally possible</span>
<span class="c1"># I am sad that terminator doesn&#39;t have "search highlight" though.</span>
sudo apt-get install terminator
gsettings <span class="nb">set</span> org.gnome.desktop.default-applications.terminal <span class="nb">exec</span> <span class="s1">&#39;terminator&#39;</span>

<span class="c1"># get zsh for history substring search and other cool stuff</span>
sudo apt-get install zsh
zsh
git clone --recursive https://github.com/sorin-ionescu/prezto.git <span class="s2">"</span><span class="si">${</span><span class="nv">ZDOTDIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">/.zprezto"</span>
setopt EXTENDED_GLOB
rm -f .zshrc
<span class="k">for</span> rcfile in <span class="s2">"</span><span class="si">${</span><span class="nv">ZDOTDIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">"</span>/.zprezto/runcoms/^README.md<span class="o">(</span>.N<span class="o">)</span><span class="p">;</span> <span class="k">do</span>
  ln -s <span class="s2">"</span><span class="nv">$rcfile</span><span class="s2">"</span> <span class="s2">"</span><span class="si">${</span><span class="nv">ZDOTDIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="si">}</span><span class="s2">/.</span><span class="si">${</span><span class="nv">rcfile</span><span class="p">:</span><span class="nv">t</span><span class="si">}</span><span class="s2">"</span>
<span class="k">done</span>
chsh -s /bin/zsh
</pre></div></td></tr></tbody></table></div><p>The configuration of <code>.zpreztorc</code> is straightforward. The only major thing I did is to add the history substring search plugin. Note that <code>'prompt'</code> must be the last one.</p><div class="filebox"><div class="filename" decode="exclude">~/.zpreztorc</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span></span>...
<span class="s1">&#39;completion&#39;</span> <span class="se">\</span>
<span class="s1">&#39;history-substring-search&#39;</span> <span class="se">\</span>
<span class="s1">&#39;prompt&#39;</span>
</pre></div></td></tr></tbody></table></div></div><p>I really like the default prompt of <code>zprezto</code> which is <code>sorin</code>, but I want normal path display and want to have current time shown as the right prompt. I also don’t like crazy git status. So I changed:</p><div class="filebox"><div class="filename" decode="exclude">~/.zprezto/modules/prompt/functions/prompt_sorin_setup</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="gu">@@ -39,7 +39,8 @@ function prompt_sorin_pwd {</span>
     _prompt_sorin_pwd="$MATCH"
     unset MATCH
   else
<span class="gd">-    _prompt_sorin_pwd="${${${${(@j:/:M)${(@s:/:)pwd}##.#?}:h}%/}//\%/%%}/${${pwd:t}//\%/%%}"</span>
<span class="gi">+    #_prompt_sorin_pwd="${${${${(@j:/:M)${(@s:/:)pwd}##.#?}:h}%/}//\%/%%}/${${pwd:t}//\%/%%}"</span>
<span class="gi">+    _prompt_sorin_pwd="${pwd}"</span>
   fi
 }

<span class="gu">@@ -80,7 +81,8 @@ function prompt_sorin_precmd {</span>
   prompt_sorin_pwd

   # Define prompts.
<span class="gd">-  RPROMPT=&#39;${editor_info[overwrite]}%(?:: %F{1}⏎%f)${VIM:+" %B%F{6}V%f%b"}&#39;</span>
<span class="gi">+  RPROMPT=&#39;[%D{%L:%M:%S %p}]&#39;</span>
<span class="gi">+  #RPROMPT=&#39;${editor_info[overwrite]}%(?:: %F{1}⏎%f)${VIM:+" %B%F{6}V%f%b"}&#39;</span>

   # Kill the old process of slow commands if it is still running.
   if (( _prompt_sorin_precmd_async_pid &gt; 0 )); then
</pre></div></td></tr></tbody></table></div></div><p><code>agnoster</code>, <code>pure</code>, and <code>powerline</code> also look interesting, but I like single line more than double line, so right now I will stick with <code>sorin</code>.</p><p>Here’s my additional settings for <code>.zshrc</code>:</p><div class="filebox"><div class="filename" decode="exclude">~/.zshrc</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="c1"># use terminal emacs as default</span>
<span class="nb">alias</span> <span class="nv">emacs</span><span class="o">=</span><span class="s1">&#39;emacs -nw&#39;</span>
<span class="c1"># use it like this: run_long_command; alert</span>
<span class="nb">alias</span> <span class="nv">alert</span><span class="o">=</span><span class="s1">&#39;notify-send --urgency=low -i "$([ $? = 0 ] &amp;&amp; echo terminal || echo error)" \</span>
<span class="s1">"$(history|tail -n1|sed -e &#39;</span><span class="se">\&#39;</span><span class="s1">&#39;s/^\s*[0-9]\+\s*//;s/[;&amp;|]\s*alert$//&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;)"&#39;</span>
</pre></div></td></tr></tbody></table></div></div><p>I like OS X’s <code>open</code> a lot. Here we have <code>xdg-open</code>, but it vomits a lot of text while running in background. Thus, I created:</p><div class="filebox"><div class="filename" decode="exclude">~/bin/open</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="ch">#!/usr/bin/zsh</span>

xdg-open <span class="nv">$@</span> <span class="p">&amp;</span>&gt; /dev/null
</pre></div></td></tr></tbody></table></div></div><p>There are a bunch of other programs I want to install</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></div></td><td class="code"><div class="source"><pre><span></span>sudo apt-get install emacs24 <span class="c1"># or emacs25, 26, whatever you want</span>

sudo apt-get install atom

sudo apt-get install clipit

sudo apt-get install liferea

sudo apt-get install powertop tlp tp-smapi-dkms acpi-call-dkms
sudo tlp start

sudo apt-get install unity-tweak-tool
sudo add-apt-repository ppa:numix/ppa
sudo apt-get install numix-icon-theme-square numix-gtk-theme
<span class="c1"># and then set the theme and icon, and get 2x2 workspace</span>

sudo apt-get install gnome-settings-daemon gnome-control-center

sudo apt-get install chromium-browser
<span class="c1"># vivaldi is also great</span>

sudo apt-get install gimp <span class="c1"># current version is gimp2.8</span>
wget https://github.com/jedireza/gimp-hidpi/archive/master.zip
unzip master.zip -d ~/.gimp-2.8/themes
<span class="c1"># need to add the theme in gimp&#39;s setting too</span>
rm master.zip

sudo apt-get install texlive-full

sudo add-apt-repository ppa:jconti/recent-notifications
sudo apt-get install indicator-notifications

sudo apt-get install rustc

sudo add-apt-repository <span class="s2">"deb https://cli-assets.heroku.com/branches/stable/apt ./"</span>
curl -L https://cli-assets.heroku.com/apt/release.key <span class="p">|</span> sudo apt-key add -
sudo apt-get install heroku
gem install bundler
sudo apt-get install ruby-dev
sudo apt-get install libmysqlclient-dev

sudo add-apt-repository ppa:nilarimogard/webupd8
sudo apt-get install gloobus-preview gloobus-sushi

sudo apt install libavcodec-extra

<span class="c1"># installing ttf-mscorefonts-installer will fail, do it manually afterward</span>
sudo apt install ubuntu-restricted-extras

<span class="c1"># manually install ttf-mscorefonts-installer</span>
<span class="c1"># 1) download all files from</span>
<span class="c1">#    https://sourceforge.net/projects/corefonts/files/the%20fonts/final/</span>
<span class="c1">#    except wd97vwr32.exe to ~/Downloads/fonts</span>
<span class="c1"># 2) setup</span>
sudo dpkg-reconfigure ttf-mscorefonts-installer
<span class="c1"># 3) need to clean up failed download to avoid annoying popup</span>
<span class="nb">cd</span> /usr/share/package-data-downloads/
sudo rm ttf-mscorefonts-installer

sudo apt install adobe-flashplugin

<span class="c1"># after setting up gpg</span>
sudo apt-get install pass
pass init GPG_KEY
pass git init

sudo apt-get install psensor

sudo apt-get install redshift redshift-gtk

sudo add-apt-repository ppa:webupd8team/java
sudo apt-get install oracle-java8-installer

sudo add-apt-repository ppa:plt/racket
sudo apt-get install racket
raco pkg install pollen
sudo apt-get install python-setuptools
sudo easy_install --upgrade Pygments

sudo apt-get install dropbox
sudo apt-get install xournal

curl -sL https://deb.nodesource.com/setup_6.x <span class="p">|</span> sudo -E bash -
sudo apt-get install -y nodejs
</pre></div></td></tr></tbody></table></div><p><a href="github.com/phw/peek">Peek</a> is a screen recorder program which produces GIF as the output. However, it needs an additional configuration to avoid freezing computer:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="c1"># the current version is 0.8.0.</span>
wget https://github.com/phw/peek/releases/download/v0.8.0/peek-0.8.0-Linux.deb
sudo dpkg -i peek-0.8.0-Linux.deb
rm peek-0.8.0-Linux.deb
</pre></div></td></tr></tbody></table></div><p>Then edit <code>/usr/share/applications/com.uploadedlobster.peek.desktop</code>‘s Exec to <code>TMPDIR=/var/tmp MAGICK_TMPDIR=/var/tmp MAGICK_TEMPORARY_PATH=/var/tmp peek</code>.</p><p>As a non-English speaker, I use dictionaries a lot. I also want it to be offline. The best program I could fine (which is also the same one I used 4 years ago) is <code>goldendict</code>. Here’s the setup:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="source"><pre><span></span>mkdir ~/dict
<span class="nb">cd</span> ~/dict
<span class="c1"># I suppose it will no longer be developed, so let&#39;s just hard code the version number</span>
<span class="c1"># EN-&gt;TH dictionary</span>
wget http://ftp.psu.ac.th/pub/stardict/stardict-lexitron-et-2.4.2.tar.bz2
<span class="c1"># TH-&gt;EN dictionary</span>
wget http://ftp.psu.ac.th/pub/stardict/stardict-lexitron-te-2.4.2.tar.bz2
tar -xf stardict-lexitron-et-2.4.2.tar.bz2
tar -xf stardict-lexitron-te-2.4.2.tar.bz2
<span class="c1"># thanks to http://jsomers.net/blog/dictionary and</span>
<span class="c1"># eduardosanchez.me/2015/09/07/installing-websters-revised-unabridged-dictionary-on-ubuntu-gnulinux/</span>
wget https://s3.amazonaws.com/jsomers/dictionary.zip
unzip dictionary.zip
<span class="nb">cd</span> dictionary
tar -xf stardict-dictd-web1913-2.4.2.tar.bz2
mv stardict-dictd-web1913-2.4.2 ~/dict
<span class="nb">cd</span> ~/dict
rm -rf dictionary *.tar.bz2
<span class="c1"># also need to add ~/dict as a directory to search for dictionaries</span>
<span class="c1"># *recursively* in goldendict</span>
</pre></div></td></tr></tbody></table></div><p>For Spotify, after the installation, we need to set the scale to make it display properly with HiDPI: change <code>/usr/share/applications/spotify.desktop</code> to use <code>Exec=spotify --force-device-scale-factor=2 %U</code>.</p><p>For Skype, I find that the version in the repository uses Qt 4, which sucks (especially on HiDPI). It’s better to get the beta version which is Qt-5-based from the <a href="https://web.skype.com/en/">webapp</a></p><p>Slack works very well without any additional configuration.</p><p>Now, I happen to often run stuff that will hang the computer, which would require me to hard-reset it if I don’t have any other plan. Although I’m using SSD now which means there is little risk of damaging the disk when hard-resetting, I still don’t want to do it. Thus, I will enable two keyboard shortcuts for the soft reset:</p><ul><li><code>sudo dpkg-reconfigure keyboard-configuration</code> in order to set <kbd>Ctrl</kbd> + <kbd>Alt</kbd> + <kbd>Backspace</kbd> to restart X server.</li><li>Edit <code>/etc/sysctl.conf</code> and set <code>kernel.sysrq=1</code> so that we can use <a href="https://en.wikipedia.org/wiki/Magic_SysRq_key">Magic SysRq key</a></li></ul><p>Last but not least, Thinkpad tweaking!</p><p>Thinkpad is overall very nice, but the keyboard layout sucks. Who the hell thinks it’s a good idea to remove “play/pause” key and replace it with those dumb “search” button? This is however easy to get back. Just go to <b>Keyboard</b> &gt; <b>Shortcuts</b> &gt; <b>Sound and Media</b> and set “Play (or play/pause)“, “Previous track”, and “Next track” to new keys.</p><p>The next one is a little bit more difficult. In Macbook Pro, I would use <kbd>Fn</kbd> + <kbd>Left</kbd> and <kbd>Fn</kbd> + <kbd>Right</kbd> for <kbd>Home</kbd> and <kbd>End</kbd>, and <kbd>Fn</kbd> + <kbd>Up</kbd> and <kbd>Fn</kbd> + <kbd>Down</kbd> for <kbd>PageUp</kbd> and <kbd>PageDn</kbd>. In Thinkpad, all <kbd>Home</kbd>, <kbd>End</kbd>, <kbd>PageUp</kbd>, and <kbd>PageDn</kbd> are keys! <kbd>PageUp</kbd> and <kbd>PageDn</kbd> seem to be in the right place, but <kbd>Home</kbd> and <kbd>End</kbd> are at the damned top row! Why?!</p><p>Ideally, I would want <kbd>Fn</kbd> + <kbd>Left</kbd> and <kbd>Fn</kbd> + <kbd>Right</kbd> back, but after a lot of Googling, I found that <kbd>Fn</kbd> in Thinkpad is a special key which is not really configurable. Fine. But when I program, I tend to use <kbd>Home</kbd> and <kbd>End</kbd> <i>a lot</i>, so I thought, I want to swap <kbd>Home</kbd>, <kbd>End</kbd> with <kbd>PageUp</kbd>, <kbd>PageDn</kbd>. This is really easy to do using <code>xkb</code>:</p><div class="filebox"><div class="filename" decode="exclude">/usr/share/X11/xkb/symbols/pc</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="gu">@@ -74,11 +74,11 @@ xkb_symbols "editing" {</span>
        symbols[Group1]= [ Pause, Break ]
     };
     key  &lt;INS&gt; {	[  Insert		]	};
<span class="gd">-    key &lt;HOME&gt; {	[  Home			]	};</span>
<span class="gd">-    key &lt;PGUP&gt; {	[  Prior		]	};</span>
<span class="gi">+    key &lt;HOME&gt; {	[  Prior		]	};</span>
<span class="gi">+    key &lt;PGUP&gt; {	[  Home			]	};</span>
     key &lt;DELE&gt; {	[  Delete		]	};
<span class="gd">-    key  &lt;END&gt; {	[  End			]	};</span>
<span class="gd">-    key &lt;PGDN&gt; {	[  Next			]	};</span>
<span class="gi">+    key  &lt;END&gt; {	[  Next			]	};</span>
<span class="gi">+    key &lt;PGDN&gt; {	[  End			]	};</span>

     key   &lt;UP&gt; {	[  Up			]	};
     key &lt;LEFT&gt; {	[  Left			]	};
</pre></div></td></tr></tbody></table></div></div><p>But when I want to read articles or news, I would use <kbd>PageUp</kbd> and <kbd>PageDn</kbd> a lot. Pressing keys on the top row would not be ideal. Thus, I created:</p><div class="filebox"><div class="filename" decode="exclude">~/bin/switch-reading-mode</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="ch">#!/usr/bin/zsh</span>

<span class="k">if</span> <span class="o">[[</span> -f ~/.switch-reading-mode <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
  xmodmap -e <span class="s2">"keycode 110 = Prior NoSymbol Prior"</span>
  xmodmap -e <span class="s2">"keycode 115 = Next NoSymbol Next"</span>
  xmodmap -e <span class="s2">"keycode 112 = Home NoSymbol Home"</span>
  xmodmap -e <span class="s2">"keycode 117 = End NoSymbol End"</span>
  rm ~/.switch-reading-mode
  sleep 0.2
  killall notify-osd
  notify-send <span class="s2">"Normal mode"</span>
<span class="k">else</span>
  xmodmap -e <span class="s2">"keycode 110 = Home NoSymbol Home"</span>
  xmodmap -e <span class="s2">"keycode 115 = End NoSymbol End"</span>
  xmodmap -e <span class="s2">"keycode 112 = Prior NoSymbol Prior"</span>
  xmodmap -e <span class="s2">"keycode 117 = Next NoSymbol Next"</span>
  touch ~/.switch-reading-mode
  sleep 0.2
  killall notify-osd
  notify-send <span class="s2">"Reading mode"</span>
<span class="k">fi</span>
</pre></div></td></tr></tbody></table></div></div><p>Then, in <b>Keyboard</b> &gt; <b>Shortcuts</b>, create a custom command which invokes <code>~/bin/switch-reading-mode</code> when pressing <kbd>CapsLock</kbd>. Indeed, when entering the reading mode, the Capslock would be on, but in the reading mode, you don’t type, so it’s fine! <i class="em em-smiley"></i> Note that the reason I choose Capslock is that it has the physical light indicator on the keyboard, meaning that I will know whether I am in the reading mode or not without having to try pressing <kbd>Home</kbd> or other keys.</p><p>Life of Thinkpad in Ubuntu also kinda sucks. Fingerprint reader <a href="https://forums.lenovo.com/t5/forums/v3_1/forumtopicpage/board-id/Special_Interest_Linux/thread-id/7920/page/1">doesn’t work</a>. <s>Neither is Tablet mode auto-rotation. In fact, I couldn’t even connect the accelerometer although I’m sure there is one because it works in Windows. So I need to manually tell Ubuntu to rotate screen, which is kinda awkward. I make it easier by calling this script (which also does other things like disabling trackpad, etc.):</s></p><div class="outdated"><div><u><b>Outdated:</b></u></div><div><div class="filebox"><div class="filename" decode="exclude">/usr/local/bin/rotate-screen</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre></div></td><td class="code"><div class="source"><pre><span></span><span class="ch">#!/usr/bin/zsh</span>
<span class="c1"># adapted from Ruben Barkow: https://gist.github.com/rubo77/daa262e0229f6e398766</span>

<span class="c1">#### configuration</span>
<span class="c1"># find your Touchscreen and Touchpad device with `xinput`</span>
<span class="nv">TouchscreenDevice</span><span class="o">=</span><span class="s1">&#39;Wacom Co.,Ltd. Pen and multitouch sensor Finger touch&#39;</span>
<span class="nv">TouchpadDevice</span><span class="o">=</span><span class="s1">&#39;SynPS/2 Synaptics TouchPad&#39;</span>

<span class="nv">touchpadEnabled</span><span class="o">=</span><span class="k">$(</span>xinput --list-props <span class="s2">"</span><span class="nv">$TouchpadDevice</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">&#39;/Device Enabled/{print $NF}&#39;</span><span class="k">)</span>
<span class="nv">screenMatrix</span><span class="o">=</span><span class="k">$(</span>xinput --list-props <span class="s2">"</span><span class="nv">$TouchscreenDevice</span><span class="s2">"</span> <span class="p">|</span> awk <span class="s1">&#39;/Coordinate Transformation Matrix/{print $5$6$7$8$9$10$11$12$NF}&#39;</span><span class="k">)</span>

<span class="c1"># Matrix for rotation</span>
<span class="c1"># ⎡ 1 0 0 ⎤</span>
<span class="c1"># ⎜ 0 1 0 ⎥</span>
<span class="c1"># ⎣ 0 0 1 ⎦</span>
<span class="nv">normal</span><span class="o">=</span><span class="s1">&#39;1 0 0 0 1 0 0 0 1&#39;</span>
<span class="nv">normal_float</span><span class="o">=</span><span class="s1">&#39;1.000000,0.000000,0.000000,0.000000,1.000000,0.000000,0.000000,0.000000,1.000000&#39;</span>

<span class="c1">#⎡ -1  0 1 ⎤</span>
<span class="c1">#⎜  0 -1 1 ⎥</span>
<span class="c1">#⎣  0  0 1 ⎦</span>
<span class="nv">inverted</span><span class="o">=</span><span class="s1">&#39;-1 0 1 0 -1 1 0 0 1&#39;</span>
<span class="nv">inverted_float</span><span class="o">=</span><span class="s1">&#39;-1.000000,0.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000,1.000000&#39;</span>

<span class="c1"># 90° to the left</span>
<span class="c1"># ⎡ 0 -1 1 ⎤</span>
<span class="c1"># ⎜ 1  0 0 ⎥</span>
<span class="c1"># ⎣ 0  0 1 ⎦</span>
<span class="nv">left</span><span class="o">=</span><span class="s1">&#39;0 -1 1 1 0 0 0 0 1&#39;</span>
<span class="nv">left_float</span><span class="o">=</span><span class="s1">&#39;0.000000,-1.000000,1.000000,1.000000,0.000000,0.000000,0.000000,0.000000,1.000000&#39;</span>

<span class="c1"># 90° to the right</span>
<span class="c1">#⎡  0 1 0 ⎤</span>
<span class="c1">#⎜ -1 0 1 ⎥</span>
<span class="c1">#⎣  0 0 1 ⎦</span>
<span class="nv">right</span><span class="o">=</span><span class="s1">&#39;0 1 0 -1 0 1 0 0 1&#39;</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"-u"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"Upside down"</span>
  xrandr -o inverted
  xinput set-prop <span class="s2">"</span><span class="nv">$TouchscreenDevice</span><span class="s2">"</span> <span class="s1">&#39;Coordinate Transformation Matrix&#39;</span> <span class="nv">$inverted</span>
  xinput disable <span class="s2">"</span><span class="nv">$TouchpadDevice</span><span class="s2">"</span>
<span class="k">elif</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="o">==</span> <span class="s2">"-t"</span> <span class="o">]</span>
<span class="k">then</span>
  <span class="nb">echo</span> <span class="s2">"90° to the left"</span>
  xrandr -o left
  xinput set-prop <span class="s2">"</span><span class="nv">$TouchscreenDevice</span><span class="s2">"</span> <span class="s1">&#39;Coordinate Transformation Matrix&#39;</span> <span class="nv">$left</span>
  xinput disable <span class="s2">"</span><span class="nv">$TouchpadDevice</span><span class="s2">"</span>
<span class="k">else</span>
  <span class="nb">echo</span> <span class="s2">"Back to normal"</span>
  xrandr -o normal
  xinput set-prop <span class="s2">"</span><span class="nv">$TouchscreenDevice</span><span class="s2">"</span> <span class="s1">&#39;Coordinate Transformation Matrix&#39;</span> <span class="nv">$normal</span>
  xinput <span class="nb">enable</span> <span class="s2">"</span><span class="nv">$TouchpadDevice</span><span class="s2">"</span>
<span class="k">fi</span>
</pre></div></td></tr></tbody></table></div></div><p>Then create three icons (don’t forget to <code>chmod +x</code> the script first):</p><div class="filebox"><div class="filename" decode="exclude">/usr/share/applications/rotate-screen-tent.desktop</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span></span>[Desktop Entry]
Type=Application
Terminal=false
Icon=un-reboot
Name=Tent Mode
Exec=/usr/local/bin/rotate-screen -u
Categories=Utility;
</pre></div></td></tr></tbody></table></div></div><div class="filebox"><div class="filename" decode="exclude">/usr/share/applications/rotate-screen-tablet.desktop</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span></span>[Desktop Entry]
Type=Application
Terminal=false
Icon=wireframing
Name=Tablet Mode
Exec=/usr/local/bin/rotate-screen -t
Categories=Utility;
</pre></div></td></tr></tbody></table></div></div><div class="filebox"><div class="filename" decode="exclude">/usr/share/applications/rotate-screen-laptop.desktop</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre><span></span>[Desktop Entry]
Type=Application
Terminal=false
Icon=system-config-displayca
Name=Laptop Mode
Exec=/usr/local/bin/rotate-screen
Categories=Utility;
</pre></div></td></tr></tbody></table></div></div><p>And drag all of these to the Unity bar. Also drag <code>/usr/share/applications/onboard.desktop</code> to the Unity bar for on-screen keyboard for non-laptop mode.</p></div></div><p>I managed to get auto-rotation to work! First:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="source"><pre><span></span>sudo apt-get install iio-sensor-proxy
systemctl start iio-sensor-proxy.service
</pre></div></td></tr></tbody></table></div><p>Then, run <code>monitor-sensor</code>. It should look like:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="source"><pre><span></span>$ monitor-sensor
    Waiting <span class="k">for</span> iio-sensor-proxy to appear
+++ iio-sensor-proxy <span class="nv">appeared</span>
<span class="o">===</span> Has accelerometer <span class="o">(</span>orientation: normal<span class="o">)</span>
<span class="o">===</span> Has ambient light sensor <span class="o">(</span>value: 0.908000, unit: lux<span class="o">)</span>
Light changed: 1.557000 <span class="o">(</span>lux<span class="o">)</span>
Light changed: 13.365001 <span class="o">(</span>lux<span class="o">)</span>
...
</pre></div></td></tr></tbody></table></div><p>If it doesn’t appear like this, there are two possibilties:</p><ol><li>The kernel you are using is <a href="https://github.com/hadess/iio-sensor-proxy/issues/71">buggy</a>!. Download and install <a href="http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.9.3/">kernel version 4.9.3</a> or later to fix this issue.</li><li>There’s a weird <a href="https://github.com/hadess/iio-sensor-proxy/issues/124">bug</a> that <code>monitor-sensor</code> won’t work unless you sleep your laptop and wake it up... So... do that.</li></ol><p>When <code>monitor-sensor</code> is working, install <code><a href="https://github.com/admiralakber/thinkpad-yoga-scripts">thinkpad-yoga-scripts</a></code> by the following instructions. Note that <code>thinkpad-yoga-scripts</code> has a lot of features that we do not need. For example, “Disabling of Touchscreen with proximity of Wacom digitizer” is working already for us. So we will not follow the instructions in the README. Instead:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="source"><pre><span></span>sudo -s
git clone https://github.com/admiralakber/thinkpad-yoga-scripts /opt/thinkpad-yoga-scripts
nano /opt/thinkpad-yoga-scripts/rotate/thinkpad-rotate.py
</pre></div></td></tr></tbody></table></div><p>Set both <code>rotate_pens</code> and <code>disable_touchpads</code> to <code>True</code>. Then:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre><span></span>cp /opt/thinkpad-yoga-scripts/systemd/yoga-rotate@.service /lib/systemd/system/
<span class="c1"># somehow systemd stuff in /usr/lib/systemd/system/ or</span>
<span class="c1"># /usr/lib/systemd/user/ doesn&#39;t work, so use this instead</span>
systemctl start yoga-rotate@<span class="nv">$USER</span>.service
</pre></div></td></tr></tbody></table></div><p>FIN <i class="em em-smiley"></i></p></div><hr/>
    </div>
    <div id="disqus_thread"></div>
    <script>
    var disqus_config = function () {
    this.page.identifier = "blog/2016-12-22-new-laptop.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//sorawee.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
</body>
</html>