<html>
<head>
  <meta charset="UTF-8">
  <title>
    Colorful Parentheses! — Sorawee's Website
  </title>
  <link rel="stylesheet" href="https://code.cdn.mozilla.net/fonts/fira.css">
  <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="all" href="../css/styles.css" />
  <link rel="stylesheet" type="text/css" media="all" href="../css/normalize.css" />
  <link rel="stylesheet" type="text/css" media="all" href="../css/styles-github.css" />
  <script type="text/javascript"
    src="https://cdn.rawgit.com/mathjax/MathJax/2.7.1/MathJax.js?config=TeX-AMS_CHTML">
  </script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {inlineMath: [['$','$']]},
      TeX: {
        Macros: {
          seq: ["{\\langle #1 \\rangle}", 1],
          set: ["{\\{ #1 \\}}", 1],
          setof: ["{\\{ #1 \\ | \\ #2 \\}}", 2],
          N: "{\\mathbb N}",
          R: "{\\mathbb R}",
          Z: "{\\mathbb Z}",
          Q: "{\\mathbb Q}",
          floor: ["{\\lfloor #1 \\rfloor}", 1],
          ceil: ["{\\lceil #1 \\rceil}", 1],
        }
      }
    });
  </script>
  <style type="text/css">.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */</style>
</head>
<body>
  <nav><ul>
    <li><a href="../blog/2017-01-06-bulk-scraping.html">&larr; Previous</a></li>
    <li><a href="../">&uarr; Home</a></li>
    <li><a href="../blog/2017-01-01-happy-new-year.html">Next &rarr;</a></li>
    <li>
      <a href="2017-01-03-colorful-parentheses.pdf">
        <img src="../css/pdficon.png" width="15" height="15" alt="Download PDF" />
        <span class="caps" style="font-style: normal">PDF</span>
      </a>
    </li>
    <li style="width: auto;">
      <a href="https://github.com/sorawee/my-website/blob/master/blog/2017-01-03-colorful-parentheses.poly.pm" title="View the Pollen source for this file"
         class="sourcelink code">&loz; Pollen Source
      </a>
    </li>
  </ul></nav>
  <section class="page-header">
    <h1 class="project-name">
      <a href="../">Sorawee's Website</a>
    </h1>
    <h2 class="project-tagline"></h2>
    <a href="../" class="btn">Blog</a>
    <a href="../books.html" class="btn">Books</a>
    <a href="../feed.xml" class="btn">RSS</a>
    <a href="../about.html" class="btn">About Me</a>
  </section>
  <section class="main-content" id="the-main">
    <div id="real-content">
      <h1>Colorful Parentheses!</h1><p class="tags">Tags: <a href="/tags/racket">racket</a>, <a href="/tags/blog">blog</a></p><p class="pubdate">Published on Tuesday, January 3rd, 2017</p><div class="content"><p>I tried to learn <a href="https://en.wikipedia.org/wiki/Continuation">continuations</a> yesterday. This led me to a <a href="http://community.schemewiki.org/?p=composable-continuations-tutorial">tutorial for composable continuations</a> in schemewiki.org. It explains things nicely, but what really intrigues me is something completely different: the colorful syntax highlight for nested parentheses when hovering cursor over them.</p><p><center><img src="/blog/img/paren-highlight.png" style="width:50%"/></center></p><p>This post, of course, explains how I managed to get it on my website!</p><p><see-more></see-more></p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">x</span> <span class="paren"><span class="p">(</span><span class="nb">+</span> <span class="mi">1</span> <span class="paren"><span class="p">(</span><span class="nb">+</span> <span class="mi">3</span> <span class="paren"><span class="p">(</span><span class="nb">+</span> <span class="mi">2</span> <span class="mi">4</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb">+</span> <span class="mi">9</span> <span class="mi">9</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>First step is straightforward: look at the source code. Here’s the result:</p><div class="filebox"><div class="filename" decode="exclude">http://community.schemewiki.org?composable-continuations-tutorial</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="source"><pre class="other"><span></span>...
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"paren"</span><span class="p">&gt;</span>(<span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">href</span><span class="o">=</span><span class="s">"http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-9.html#%_idx_278"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"scheme-documentation"</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> 1 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"paren"</span><span class="p">&gt;</span>(<span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">href</span><span class="o">=</span><span class="s">"http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-9.html#%_idx_278"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"scheme-documentation"</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> 3 <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">"paren"</span><span class="p">&gt;</span>(<span class="p">&lt;</span><span class="nt">a</span>
  <span class="na">href</span><span class="o">=</span><span class="s">"http://www.schemers.org/Documents/Standards/R5RS/HTML/r5rs-Z-H-9.html#%_idx_278"</span>
      <span class="na">class</span><span class="o">=</span><span class="s">"scheme-documentation"</span><span class="p">&gt;</span>+<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> 2 4)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>)<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
...
</pre></div></td></tr></tbody></table></div></div><p>for <code>(+ 1 (+ 3 (+ 2 4)))</code>. Something is going on with that class <code>paren</code>... Perhaps JavaScript? But I searched for <code>js</code> in the source code and found nothing...</p><p>CSS? I saw <code>&lt;link rel="stylesheet" href="/css/default.css" type="text/css"&gt;</code> at the top of the file...</p><div class="filebox"><div class="filename" decode="exclude">http://community.schemewiki.org/css/default.css</div><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149</pre></div></td><td class="code"><div class="source"><pre class="other"><span></span><span class="o">...</span>
<span class="c">/* The paren stuff */</span>

<span class="c">/* Top level */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 1 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 2 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 3 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 4 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 5 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 6 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#B4E1EA</span> <span class="p">}</span>

<span class="c">/* Paren level 7 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#BDEAB4</span> <span class="p">}</span>

<span class="c">/* Paren level 8 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#EAD4B4</span> <span class="p">}</span>

<span class="c">/* Paren level 9 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F4D0EC</span> <span class="p">}</span>

<span class="c">/* Paren level 10 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#D0D9F4</span> <span class="p">}</span>

<span class="c">/* Paren level 11 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 12 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 13 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 14 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 15 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFFF</span> <span class="p">}</span>

<span class="c">/* Paren level 16 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 17 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#BDEAB4</span> <span class="p">}</span>

<span class="c">/* Paren level 18 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#EAD4B4</span> <span class="p">}</span>

<span class="c">/* Paren level 19 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#F4D0EC</span> <span class="p">}</span>

<span class="c">/* Paren level 20 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#D0D9F4</span> <span class="p">}</span>

<span class="c">/* Paren level 21 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#FFCFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 22 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="c">/* Paren level 23 */</span>
<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">hover</span> <span class="p">{</span> <span class="k">background-color</span><span class="p">:</span> <span class="mh">#CFFFCF</span> <span class="p">}</span>

<span class="nt">PRE</span><span class="p">.</span><span class="nc">scheme</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
           <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span> <span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span>
<span class="o">&gt;</span> <span class="nt">SPAN</span><span class="p">.</span><span class="nc">paren</span><span class="p">:</span><span class="nd">before</span> <span class="p">{</span> <span class="k">content</span><span class="p">:</span> <span class="s2">"{{23 levels of indentation?! Yiakes!}}"</span> <span class="p">}</span>

<span class="c">/* extend here if more nestings are needed */</span>
<span class="o">...</span>
</pre></div></td></tr></tbody></table></div></div><p>Oh yeah...<label for="c39a919b-0adb-4b09-abf6-fd5513eb9ebb" class="margin-toggle sidenote-number"></label><input type="checkbox" id="c39a919b-0adb-4b09-abf6-fd5513eb9ebb" class="margin-toggle"/><span class="sidenote">In fact, what I should do is to generate the CSS file according to the maximum number of depth of all source codes...</span></p><p>This method requires that the matching parentheses are grouped together in one <code>span</code>. This would be easy for raw text because in Racket we have <code>read</code> which would transform the whole code to an S-Expression, grouping matching parentheses nicely. However, the current workflow is to use Pygments on the raw text to get the syntax highlight for keywords. Suppose we were to do a preprocess on the raw text to add some information about matching parentheses, Pygments could highlight the code completely wrong. But if we were to do a postprocess on the output of Pygments, we would get HTML nodes instead, which is not readable by <code>read</code>.</p><p>So we will do the postprocess, and instead of relying on <code>read</code>, we will parse the data manually. Note, though, that Pygments is not only doing a syntax highlight. It also acts as a lexer. That means left parenthesis and left parenthesis in a quote would be distinguishable, which is pretty nice. Here’s an example of an output from Pygments:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"highlight"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">table</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"sourcetable"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">tbody</span> <span class="paren"><span class="p">(</span><span class="ss">tr</span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenos"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenodiv"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="s2">" 1</span><span class="se">\n</span><span class="s2"> 2</span><span class="se">\n</span><span class="s2"> 3</span><span class="se">\n</span><span class="s2"> 4</span><span class="se">\n</span><span class="s2"> 5</span><span class="se">\n</span><span class="s2">..."</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"code"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"source"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="paren"><span class="p">(</span><span class="ss">span</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"kn"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"#lang "</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"nn"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"racket"</span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"define-syntax-rule"</span><span class="p">)</span></span> <span class="s2">" "</span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"n"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"def"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"n"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"whatever"</span><span class="p">)</span></span>
<span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"..."</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">")"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"define"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"n"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"whatever"</span><span class="p">)</span></span> <span class="s2">" "</span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"..."</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"))"</span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"k"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"define-syntax-rule"</span><span class="p">)</span></span> <span class="s2">" "</span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span> <span class="ss">...</span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>This blob of data contains what we want, but it’s not exactly a stream of tokens. To extract that out, we use a straightforward pattern matching<label for="530c120a-fb0e-4e50-bf43-f53e47acdbf5" class="margin-toggle sidenote-number"></label><input type="checkbox" id="530c120a-fb0e-4e50-bf43-f53e47acdbf5" class="margin-toggle"/><span class="sidenote">And I thought, isn’t there jQuery for X-Expression? Then I found <a href="http://cs.brown.edu/~sk/Publications/Papers/Published/kk-sxslt/">this paper</a>... It’s not compatible with X-Expression though, and that’s why I didn’t use it.</span>:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k">match</span> <span class="paren"><span class="p">(</span><span class="n">highlight</span> <span class="k">...</span><span class="p">)</span></span>
  <span class="paren"><span class="p">[</span><span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"highlight"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">table</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"sourcetable"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">tbody</span> <span class="paren"><span class="p">(</span><span class="ss">tr</span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenos"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenodiv"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="o">,</span><span class="n">linenos</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"code"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"source"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="o">,</span><span class="n">things-in-pre</span> <span class="ss">...</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span>
   <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"highlight"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">table</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"sourcetable"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">tbody</span> <span class="paren"><span class="p">(</span><span class="ss">tr</span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenos"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"linenodiv"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="o">,</span><span class="n">linenos</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">td</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"code"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">div</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"source"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="ss">pre</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"scheme"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="o">,@</span><span class="paren"><span class="p">(</span><span class="n">parenthesize</span> <span class="n">things-in-pre</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
   <span class="c1">; add class scheme to pre to make CSS works</span>
</pre></div></td></tr></tbody></table></div><p>So what we need to do is to write a function <code>parenthesize</code> to match <code>(span ((class "p")) "(")</code> with <code>(span ((class "p")) ")")</code>. Notice however that right now adjacent parentheses are grouped together, like <code>(span ((class "p")) "))")</code>. Therefore, we need to first normalize them by splitting them to multiple tokens: <code>(span ((class "p")) ")")</code> and <code>(span ((class "p")) ")")</code>.</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k">define</span> <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">lst</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k">match</span> <span class="n">lst</span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="o">,</span><span class="n">str</span><span class="p">)</span></span> <span class="n">rst</span> <span class="k">...</span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="nb">append</span> <span class="paren"><span class="p">(</span><span class="nb">map</span> <span class="paren"><span class="p">(</span><span class="k">λ</span> <span class="paren"><span class="p">(</span><span class="n">x</span><span class="p">)</span></span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="o">,</span><span class="paren"><span class="p">(</span><span class="nb">string</span> <span class="n">x</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb">string-&gt;list</span> <span class="n">str</span><span class="p">)</span></span><span class="p">)</span></span>
             <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">rst</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">fst</span> <span class="n">rst</span> <span class="k">...</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="n">fst</span> <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">rst</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k">_</span> <span class="n">lst</span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>After normalization, we now need to do the real work which is to parse and group matching parentheses together. There are obvious and efficient algorithms to do this, but I’ve heard that Racket’s pattern matching is pretty powerful, so let’s try that. The idea is to find an innermost matching parentheses and group them one at a time, then repeat until there is no more matching parentheses left.</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">left-paren</span> <span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">"("</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">right-paren</span> <span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">(</span><span class="ss">class</span> <span class="s2">"p"</span><span class="p">)</span></span><span class="p">)</span></span> <span class="s2">")"</span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">not-paren?</span> <span class="paren"><span class="p">(</span><span class="nb">negate</span> <span class="paren"><span class="p">(</span><span class="nb">curryr</span> <span class="nb">member</span> <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">left-paren</span> <span class="n">right-paren</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k">define</span> <span class="paren"><span class="p">(</span><span class="n">iter</span> <span class="n">lst</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k">match</span> <span class="n">lst</span>
    <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">prefix-tok</span> <span class="k">...</span>
           <span class="paren"><span class="p">(</span><span class="k">==</span> <span class="n">left-paren</span><span class="p">)</span></span>
           <span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">not-paren?</span> <span class="n">inside</span><span class="p">)</span></span> <span class="k">...</span>
           <span class="paren"><span class="p">(</span><span class="k">==</span> <span class="n">right-paren</span><span class="p">)</span></span>
           <span class="n">suffix-tok</span> <span class="k">...</span><span class="p">)</span></span>
     <span class="paren"><span class="p">(</span><span class="n">iter</span> <span class="paren"><span class="p">(</span><span class="nb">append</span> <span class="n">prefix-tok</span>
                   <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">[</span><span class="paren"><span class="p">[</span><span class="ss">class</span> <span class="s2">"paren"</span><span class="p">]</span></span><span class="p">]</span></span>
                                <span class="o">,</span><span class="n">left-paren</span> <span class="o">,@</span><span class="n">inside</span> <span class="o">,</span><span class="n">right-paren</span><span class="p">)</span></span><span class="p">)</span></span>
                   <span class="n">suffix-tok</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
    <span class="paren"><span class="p">[</span><span class="k">_</span> <span class="n">lst</span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>And finally define <code>parenthesize</code>:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">parenthesize</span> <span class="paren"><span class="p">(</span><span class="nb">compose1</span> <span class="n">iter</span> <span class="n">normalize</span><span class="p">)</span></span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>And <i>holy cow, it works!</i> Pretty quickly too. The exact time complexity is unclear since I do not know how the magic of pattern matching works. Note that the matching patterns are not static data, so the compiler would not be able to exploit this much. Thus, we can assume that the compiler will generate a dumb code to try to match things. Finding an innermost matching parentheses definitely takes at least linear time, and we repeat it until there’s no more matching parentheses. That is, the algorithm would be at least quadratic. Since the code in my blog would be at most 500 lines long, that’s pretty chill.</p><p>But let’s see how we will improve this and make it linear time. There are in fact several ways to do it. <a href="http://justinpombrio.net">Justin</a> particularly likes the stack solution one:</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">left-thing?</span> <span class="paren"><span class="p">(</span><span class="nb">curryr</span> <span class="nb">member</span> <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">left-paren</span> <span class="n">left-bracket</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k">define</span> <span class="n">right-thing?</span> <span class="paren"><span class="p">(</span><span class="nb">curryr</span> <span class="nb">member</span> <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">right-paren</span> <span class="n">right-bracket</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="k">define-values</span> <span class="paren"><span class="p">(</span><span class="n">parsed-flipped</span><span class="p">)</span></span>
  <span class="paren"><span class="p">(</span><span class="k">for/fold</span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">stack</span> <span class="o">&#39;</span><span class="paren"><span class="p">(</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="paren"><span class="p">[</span><span class="n">e</span> <span class="paren"><span class="p">(</span><span class="n">normalize</span> <span class="n">lst</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
    <span class="paren"><span class="p">(</span><span class="k">match</span> <span class="n">e</span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">left-thing?</span> <span class="n">lp</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb">values</span> <span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="n">lp</span> <span class="n">stack</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
      <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">right-thing?</span> <span class="n">rp</span><span class="p">)</span></span>
       <span class="paren"><span class="p">(</span><span class="k">define-values</span> <span class="paren"><span class="p">(</span><span class="n">grouped</span> <span class="n">new-stack</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="nb">splitf-at</span> <span class="n">stack</span> <span class="paren"><span class="p">(</span><span class="nb">negate</span> <span class="n">left-thing?</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
       <span class="paren"><span class="p">(</span><span class="nb">values</span>
         <span class="paren"><span class="p">(</span><span class="k">match</span> <span class="n">new-stack</span>
           <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="paren"><span class="p">(</span><span class="n">?</span> <span class="n">left-thing?</span> <span class="n">lp</span><span class="p">)</span></span> <span class="k">_</span> <span class="k">...</span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="k">match</span> <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">lp</span> <span class="n">rp</span><span class="p">)</span></span>
              <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="paren"><span class="p">(</span><span class="k">==</span> <span class="n">left-paren</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k">==</span> <span class="n">right-paren</span><span class="p">)</span></span><span class="p">)</span></span> <span class="no">#f</span><span class="p">]</span></span>
              <span class="paren"><span class="p">[</span><span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="paren"><span class="p">(</span><span class="k">==</span> <span class="n">left-bracket</span><span class="p">)</span></span> <span class="paren"><span class="p">(</span><span class="k">==</span> <span class="n">right-bracket</span><span class="p">)</span></span><span class="p">)</span></span> <span class="no">#f</span><span class="p">]</span></span>
              <span class="paren"><span class="p">[</span><span class="k">_</span> <span class="paren"><span class="p">(</span><span class="nb">error</span> <span class="o">&#39;</span><span class="ss">mismatched-type-paren</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span>
            <span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="o">`</span><span class="paren"><span class="p">(</span><span class="ss">span</span> <span class="paren"><span class="p">[</span><span class="paren"><span class="p">[</span><span class="ss">class</span> <span class="s2">"paren"</span><span class="p">]</span></span><span class="p">]</span></span>
                         <span class="o">,@</span><span class="paren"><span class="p">(</span><span class="nb">reverse</span> <span class="paren"><span class="p">(</span><span class="nb">append</span> <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">rp</span><span class="p">)</span></span> <span class="n">grouped</span> <span class="paren"><span class="p">(</span><span class="nb">list</span> <span class="n">lp</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
                  <span class="paren"><span class="p">(</span><span class="nb">rest</span> <span class="n">new-stack</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span>
           <span class="paren"><span class="p">[</span><span class="k">_</span> <span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="n">e</span> <span class="n">stack</span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span> <span class="c1">; if too many right parentheses</span>
      <span class="paren"><span class="p">[</span><span class="k">_</span> <span class="paren"><span class="p">(</span><span class="nb">values</span> <span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="n">e</span> <span class="n">stack</span><span class="p">)</span></span><span class="p">)</span></span><span class="p">]</span></span><span class="p">)</span></span><span class="p">)</span></span><span class="p">)</span></span>
<span class="paren"><span class="p">(</span><span class="nb">reverse</span> <span class="n">parsed-flipped</span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>This algorithm also tolerates mismatched parentheses<label for="a9502c0e-fd9d-4c6c-b6d4-a067b241a8d7" class="margin-toggle sidenote-number"></label><input type="checkbox" id="a9502c0e-fd9d-4c6c-b6d4-a067b241a8d7" class="margin-toggle"/><span class="sidenote">I haven’t tested this functionalities that much because, you know, normally I wouldn’t have mismatched parentheses. So... it’s possible that this will be buggy when there are mismatched parentheses.</span> (but not mismatch type), because it’s possible that I will just copy and paste only a part of a code from somewhere else, which doesn’t have complete matching parentheses.</p><div class="highlight"><table class="sourcetable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="source"><pre class="racket"><span></span><span class="c1">; this has too many right parentheses</span>
<span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span></span><span class="err">)</span>
<span class="c1">; this has too many left parentheses</span>
<span class="p">(</span><span class="paren"><span class="p">(</span><span class="nb">cons</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span></span>
</pre></div></td></tr></tbody></table></div><p>And that, my friends, is how you get colorful parentheses. <i class="em em-smiley"></i></p></div><hr/>
    </div>
    <div id="disqus_thread"></div>
    <script>
    var disqus_config = function () {
    this.page.identifier = "blog/2017-01-03-colorful-parentheses.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//sorawee.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </section>
</body>
</html>